<!-- HTML header for doxygen 1.8.3.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.3.1"/>
<title>nRF5 SDK v13.0.0: Bootloader</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="extra_stylesheet_offline.css" rel="stylesheet" type="text/css"/>
<link href="nordic.css" rel="stylesheet" type="text/css" />
<link rel="Shortcut icon" href="./favicon.ico" type="image/x-icon" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0" width="100%" class="blank">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Nordic Semiconductor" src="nordic_small.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">nRF5 SDK
   &#160;<span id="projectnumber">v13.0.0</span>
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
<table cellspacing="0" cellpadding="0" class="blank">
<tr>
<td class="doclinkintro">Choose documentation:</td>
<td class="doclinks" id="nrf5"><a href="../nrf5/index.html">nRF5 SDK</a></td>
<td class="doclinks" id="s132"><a href="../s132/index.html">S132 SoftDevice API</a></td>
<td class="doclinks" id="s140"><a href="../s140/index.html">S140 SoftDevice API</a></td>
<td class="doclinks" id="s212"><a href="../s212/index.html">S212 SoftDevice API</a></td>
<!--<td class="doclinks" id="s332"><a href="../s332/index.html">S332 SoftDevice API</a></td>-->
</tr>
</table>
<script>
var url=window.location.href.split("/").reverse()[1];
var validLinks= ["nrf5","s132","s140","s212","s332"];
var index;
for (index = 0; index < validLinks.length; ++index) {
   if ( url.indexOf(validLinks[index]) !== -1 ) {
      document.getElementById(validLinks[index]).setAttribute('class', 'doclinks docselected');
   };
};
</script>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.3.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('lib_bootloader.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Bootloader </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The <a class="el" href="group__sdk__bootloader.html">Bootloader</a> module provides functions to implement a stand-alone bootloader that can bootstrap an application. This bootloader can be extended to provide cryptography functions, DFU support, or custom functionality.</p>
<p>In the most basic form, the bootloader will only start the application that is present at a specific memory address. This behavior is the same as not using a bootloader, so there is no real use case to implement such a basic bootloader. However, you can extend the bootloader with a custom initialization, for example. Another possible use case is that you might want to use the bootloader to switch between several applications that are installed on the device, for example depending on which button is pressed while the device starts.</p>
<p>In your bootloader code, call <a class="el" href="group__sdk__bootloader.html#gad8f905b26065473afdc69caba6b57f4d">nrf_bootloader_init</a> to initialize the bootloader. This function internally calls <a class="el" href="group__sdk__bootloader.html#ga0e84b3a7602ebd605e40f874735cb0bf">nrf_bootloader_user_init</a>, a function that you can override in your implementation to add custom functionality to the initialization. If you are using <a class="el" href="lib_bootloader_dfu.html">nrf_dfu</a> to create a bootloader with DFU functionality, the initialization function also calls <a class="el" href="group__sdk__nrf__dfu.html#ga86a3f104a0dae9f97d932d8f7d8a1541">nrf_dfu_init</a>.</p>
<p>After initialization, your bootloader code should call <a class="el" href="group__sdk__bootloader__app.html#ga254b044d6a01f6eaba5cfc6a87f24cb7">nrf_bootloader_app_start</a> to start an application at a given memory address.</p>
<h1><a class="anchor" id="lib_bootloader_programming"></a>
Programming the bootloader</h1>
<p>During system startup, the Master Boot Record (MBR) is responsible for starting the bootloader, if a bootloader is installed. To do this, the MBR must know the start address of the bootloader. This start address is defined in UICR.BOOTLOADERADDR, which is located at address 0x10001014 (see <a class="el" href="group__sdk__bootloader__info.html#ga2bf97cf1e3069ab5cbb861a749a206d3">NRF_UICR_BOOTLOADER_START_ADDRESS</a>). Therefore, you must set UICR.BOOTLOADERADDR to the correct value when you program the bootloader.</p>
<p>Programming the bootloader requires the following steps:</p>
<ol type="1">
<li>Erase the device.</li>
<li>Program the SoftDevice. See <a class="el" href="getting_started_softdevice.html#getting_started_sd">Programming SoftDevices</a> for instructions.</li>
<li>Compile the bootloader.</li>
<li>Program the bootloader and write to UICR.BOOTLOADERADDR. See the following sections for instructions for <a class="el" href="lib_bootloader.html#lib_bootloader_programming_keil">Keil</a>, <a class="el" href="lib_bootloader.html#lib_bootloader_programming_iar">IAR</a>, and <a class="el" href="lib_bootloader.html#lib_bootloader_programming_nrfjprog">nrfjprog</a> directly (if you are using GCC).</li>
</ol>
<h2><a class="anchor" id="lib_bootloader_programming_keil"></a>
Using Keil</h2>
<p>You cannot write to UICR.BOOTLOADERADDR when using the default J-Link target driver in Keil. Therefore, you must configure Keil to use an external tool, <a href="http://infocenter.nordicsemi.com/topic/com.nordic.infocenter.tools/dita/tools/nrf5x_command_line_tools/nrf5x_nrfjprogexe.html">nrfjprog</a>. To do so, select <b>Project</b> &gt; <b>Options for Target '<em>xxx</em>'</b> and configure <code>nrfjprog.exe</code> as the tool for flash programming. <code>nrfjprog.exe</code> is installed with the nRF5 MDK and must be in the Windows system path. The following screenshot shows the required settings for <code>nrfjprog.exe:</code> </p>
<div class="image">
<img src="keil_project_flash_tool_nrf52.png" alt="keil_project_flash_tool_nrf52.png"/>
<div class="caption">
Flash tool configuration in Keil</div></div>
<p>After configuring the flash command, program the bootloader as you would do with a normal application. If several J-Link emulators are connected, select the one that contains the nRF5 IC that you want to flash.</p>
<h2><a class="anchor" id="lib_bootloader_programming_iar"></a>
Using IAR</h2>
<p>You cannot write to UICR.BOOTLOADERADDR when using the default J-Link target driver in IAR. Therefore, you must set up <a href="http://infocenter.nordicsemi.com/topic/com.nordic.infocenter.tools/dita/tools/nrf5x_command_line_tools/nrf5x_nrfjprogexe.html">nrfjprog</a> as an external tool. To do so, select <b>Tools</b> &gt; <b>Configure Tools</b>. <code>nrfjprog.exe</code> is installed with the nRF5 MDK and must be in the Windows system path. The following screenshot shows the settings for <code>nrfjprog.exe:</code> </p>
<div class="image">
<img src="iar_project_flash_tool_nrf52.png" alt="iar_project_flash_tool_nrf52.png"/>
<div class="caption">
Flash tool configuration in IAR</div></div>
<p>Change "app.hex" to the file name of your HEX file and the initial directory to the directory that contains the HEX file. After configuring the flash command, program the bootloader as you would do with a normal application. If several J-Link emulators are connected, select the one that contains the nRF5 IC that you want to flash.</p>
<h2><a class="anchor" id="lib_bootloader_programming_nrfjprog"></a>
Using nrfjprog directly (for GCC)</h2>
<p>You can also program the bootloader using <a href="http://infocenter.nordicsemi.com/topic/com.nordic.infocenter.tools/dita/tools/nrf5x_command_line_tools/nrf5x_nrfjprogexe.html">nrfjprog</a> directly from the command line. To do so, run the following command: </p>
<div class="fragment"><div class="line">nrfjprog --reset --program application.hex --family NRF52</div>
</div><!-- fragment --><p>Change "application.hex" to the file name of your HEX file.</p>
<h1><a class="anchor" id="lib_bootloader_memory"></a>
Memory layout</h1>
<p>When adding a bootloader to your device, you must be aware of where in the device memory the different firmware components are located.</p>
<p>The following table shows the memory layout for the different chips with current SoftDevices:</p>
<table class="doxtable">
<tr>
<th>Usage </th><th>Memory range nRF52832 (S132 v5.0.x) </th><th>Memory range nRF52840 (S140 v5.0.x)</th></tr>
<tr>
<td>Bootloader settings </td><td>0x0007 F000 - 0x0008 0000 (4 kB) </td><td>0x000F F000 - 0x0010 0000 (4 kB) </td></tr>
<tr>
<td>MBR parameter storage </td><td>0x0007 E000 - 0x0007 F000 (4 kB) </td><td>0x000F E000 - 0x000F F000 (4 kB) </td></tr>
<tr>
<td>Bootloader </td><td>0x0007 8000 - 0x0007 E000 (24 kB) </td><td>0x000F 8000 - 0x000F E000 (24 kB) </td></tr>
<tr>
<td>Application area (incl. free space) </td><td>0x0002 0000 - 0x0007 8000 (352 kB) </td><td>0x0002 0000 - 0x000F 8000 (864 kB) </td></tr>
<tr>
<td>SoftDevice </td><td>0x0000 1000 - 0x0002 0000 (124 kB) </td><td>0x0000 1000 - 0x0002 0000 (124 kB) </td></tr>
<tr>
<td>Master Boot Record (MBR) </td><td>0x0000 0000 - 0x0000 1000 (4 kB) </td><td>0x0000 0000 - 0x0000 1000 (4 kB) </td></tr>
</table>
<p>The following figure shows the default memory layout for nRF52 devices, where nRF52832 has a flash size of 512 kB and nRF52840 has a flash size of 1024 kB:</p>
<div class="image">
<img src="bootloader_memory_nrf52.svg" alt="bootloader_memory_nrf52.svg"/>
</div>
 </div></div><!-- contents -->
</div><!-- doc-content -->
<div id="nav-path" class="topicfooter">
<a href="mailto:docfeedback@nordicsemi.no?subject=Documentation%20feedback" id="maillink">Documentation feedback</a> | <a href="https://devzone.nordicsemi.com/questions/" target="_blank">Developer Zone</a> | <a href="http://response.nordicsemi.com/subscribe-to-our-newsletters" target="_blank">Subscribe</a> | Updated <span id="date"/>
<script>
var date = new Date("Fri Mar 10 2017" + " UTC");
document.getElementById("date").innerHTML = date.toJSON().slice(0, 10);
var url=window.location.href.split("?")[0];
var filename=url.substring(url.lastIndexOf('/')+1);
document.getElementById("maillink").href = "mailto:docfeedback@nordicsemi.no?subject=Documentation%20feedback"+decodeURIComponent("%26")+"body=File%20name%3A%20"+encodeURIComponent(filename);
</script>
</div>
</body>
</html>
