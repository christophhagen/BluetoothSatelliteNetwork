<!-- HTML header for doxygen 1.8.3.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.3.1"/>
<title>nRF5 SDK v13.0.0: DFU transport</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="extra_stylesheet_offline.css" rel="stylesheet" type="text/css"/>
<link href="nordic.css" rel="stylesheet" type="text/css" />
<link rel="Shortcut icon" href="./favicon.ico" type="image/x-icon" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0" width="100%" class="blank">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Nordic Semiconductor" src="nordic_small.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">nRF5 SDK
   &#160;<span id="projectnumber">v13.0.0</span>
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
<table cellspacing="0" cellpadding="0" class="blank">
<tr>
<td class="doclinkintro">Choose documentation:</td>
<td class="doclinks" id="nrf5"><a href="../nrf5/index.html">nRF5 SDK</a></td>
<td class="doclinks" id="s132"><a href="../s132/index.html">S132 SoftDevice API</a></td>
<td class="doclinks" id="s140"><a href="../s140/index.html">S140 SoftDevice API</a></td>
<td class="doclinks" id="s212"><a href="../s212/index.html">S212 SoftDevice API</a></td>
<!--<td class="doclinks" id="s332"><a href="../s332/index.html">S332 SoftDevice API</a></td>-->
</tr>
</table>
<script>
var url=window.location.href.split("/").reverse()[1];
var validLinks= ["nrf5","s132","s140","s212","s332"];
var index;
for (index = 0; index < validLinks.length; ++index) {
   if ( url.indexOf(validLinks[index]) !== -1 ) {
      document.getElementById(validLinks[index]).setAttribute('class', 'doclinks docselected');
   };
};
</script>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.3.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('lib_dfu_transport.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">DFU transport </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The DFU process is designed to be transport agnostic, as long as a reliable transport layer is used. The DFU transport module defines a generic interface that must be implemented for each transport layer. Currently, the DFU transport module supports BLE and serial transport (experimental).</p>
<p>To register a transport layer, call the macro <a class="el" href="group__sdk__nrf__dfu__transport.html#gad761bc7b7454d09a2238af7187a207ef">DFU_TRANSPORT_REGISTER</a> with a <a class="el" href="structnrf__dfu__transport__t.html">nrf_dfu_transport_t</a> registration structure as parameter. When <a class="el" href="group__sdk__nrf__dfu__transport.html#ga2db80b3854cba275ff06f7ca9700ddef">nrf_dfu_transports_init</a> is called, all registered transport layers are initialized with their respective init functions (as defined in <a class="el" href="structnrf__dfu__transport__t.html#a8d35c78627bf04ecf39d05fc18d3b823">nrf_dfu_transport_t::init_func</a>).</p>
<p>The transport layer implementation is responsible for forwarding DFU requests to the application by calling <a class="el" href="group__sdk__nrf__dfu__req__handler.html#gaf013a692d389cc1f43a0cffbfde5e0a9">nrf_dfu_req_handler_on_req</a>. This function takes a request of type <a class="el" href="group__sdk__nrf__dfu__req__handler.html#gac718d0204baed25a1bef3d01484c59f6">nrf_dfu_req_op_t</a> and returns a response of type <a class="el" href="structnrf__dfu__res__t.html">nrf_dfu_res_t</a>, along with a response code of type <a class="el" href="group__nrf__dfu__rescodes.html#ga31217e9d52d12cb3d3dc3c2c5cba4211">nrf_dfu_res_code_t</a>.</p>
<p>The following table shows the types of request (see <a class="el" href="structnrf__dfu__req__t.html#ac97ba2d265a6fbaa3431d21abb23822d">nrf_dfu_req_t::req_type</a>) and responses (see <a class="el" href="structnrf__dfu__res__t.html">nrf_dfu_res_t</a>):</p>
<table class="doxtable">
<tr>
<th>Request </th><th>Opcode </th><th>Type </th><th>Parameters </th><th>Response parameters  </th></tr>
<tr>
<td><a class="el" href="lib_dfu_transport.html#lib_dfu_transport_op_create">Create</a> </td><td>0x01 </td><td><a class="el" href="group__sdk__nrf__dfu__req__handler.html#ggac718d0204baed25a1bef3d01484c59f6a16f83f7891e8e828e0b00cfd7aa587ce">NRF_DFU_OBJECT_OP_CREATE</a> </td><td><a class="el" href="structnrf__dfu__req__t.html#aa39536e3382ec447f89b1f78085da8c0">Object type</a><br/>
 <a class="el" href="structnrf__dfu__req__t.html#a7884fde25086b0ae77ab61c1aa09dd8e">Object size</a> </td><td>None  </td></tr>
<tr>
<td><a class="el" href="lib_dfu_transport.html#lib_dfu_transport_op_write">Write</a> </td><td>0x02 </td><td><a class="el" href="group__sdk__nrf__dfu__req__handler.html#ggac718d0204baed25a1bef3d01484c59f6af59b92b16d58fc96513349b45b890ffe">NRF_DFU_OBJECT_OP_WRITE</a> </td><td><a class="el" href="structnrf__dfu__req__t.html#a1f0d63db77bdf18d18a125211b5a8d43">Request</a><br/>
 <a class="el" href="structnrf__dfu__req__t.html#a7bf8b265597d608c2d14c24f3465f0fc">Request length</a> </td><td><a class="el" href="structnrf__dfu__res__t.html#aef0594664ac548e29d931e3124244099">Offset</a><br/>
 <a class="el" href="structnrf__dfu__res__t.html#a2b2c77b14de5fa6fecb904d9a6c72abb">CRC</a>   </td></tr>
<tr>
<td><a class="el" href="lib_dfu_transport.html#lib_dfu_transport_op_crc">CRC</a> </td><td>0x03 </td><td><a class="el" href="group__sdk__nrf__dfu__req__handler.html#ggac718d0204baed25a1bef3d01484c59f6a1acff0e79d0d905301593134fdaba129">NRF_DFU_OBJECT_OP_CRC</a> </td><td>None </td><td><a class="el" href="structnrf__dfu__res__t.html#aef0594664ac548e29d931e3124244099">Offset</a><br/>
 <a class="el" href="structnrf__dfu__res__t.html#a2b2c77b14de5fa6fecb904d9a6c72abb">CRC</a>   </td></tr>
<tr>
<td><a class="el" href="lib_dfu_transport.html#lib_dfu_transport_op_execute">Execute</a> </td><td>0x04 </td><td><a class="el" href="group__sdk__nrf__dfu__req__handler.html#ggac718d0204baed25a1bef3d01484c59f6ae3b628136bc65910bfe74650843a7a2e">NRF_DFU_OBJECT_OP_EXECUTE</a> </td><td>None </td><td>None  </td></tr>
<tr>
<td><a class="el" href="lib_dfu_transport.html#lib_dfu_transport_op_select">Select</a> </td><td>0x06 </td><td><a class="el" href="group__sdk__nrf__dfu__req__handler.html#ggac718d0204baed25a1bef3d01484c59f6a63b33d606af8acb19521de83bc991065">NRF_DFU_OBJECT_OP_SELECT</a> </td><td><a class="el" href="structnrf__dfu__req__t.html#aa39536e3382ec447f89b1f78085da8c0">Object type</a> </td><td><a class="el" href="structnrf__dfu__res__t.html#aef0594664ac548e29d931e3124244099">Offset</a><br/>
 <a class="el" href="structnrf__dfu__res__t.html#a2b2c77b14de5fa6fecb904d9a6c72abb">CRC</a><br/>
 <a class="el" href="structnrf__dfu__res__t.html#a511b5d7c777182073e6f472a9801a96c">Maximum object size</a>  </td></tr>
</table>
<p>The data transfer is handled differently for each transport. Some transports require the data to be split into smaller packets. Some require a termination signal to indicate that the transfer is finished. Because of these differences, the DFU controller must keep track of the amount of data that has been transferred. Based on the returned offset and CRC it can determine whether the data has been transferred completely and when it can send the Execute request.</p>
<h1><a class="anchor" id="lib_dfu_transport_op_descriptions"></a>
Requests</h1>
<p>When calling <a class="el" href="group__sdk__nrf__dfu__req__handler.html#gaf013a692d389cc1f43a0cffbfde5e0a9">nrf_dfu_req_handler_on_req</a> to submit a request, a result code of type <a class="el" href="group__nrf__dfu__rescodes.html#ga31217e9d52d12cb3d3dc3c2c5cba4211">nrf_dfu_res_code_t</a> is returned. When the DFU request was handled successfully, the result code is <a class="el" href="group__nrf__dfu__rescodes.html#gga31217e9d52d12cb3d3dc3c2c5cba4211a8934202d8cf397e2fcc76dcef027e602">NRF_DFU_RES_CODE_SUCCESS</a>. Possible error codes depend on the kind of request; see the following sections for more information. If several errors occur, only one error code is returned.</p>
<h2><a class="anchor" id="lib_dfu_transport_op_create"></a>
Create request</h2>
<p>The Create request triggers the creation of an object of the specified type. Valid types are a command object (for example, an init packet) or a data object.</p>
<p>A Create request requires the following actions on the DFU target:</p>
<ul>
<li>Reserve space for an object</li>
<li>Reset the progress since the last Execute command</li>
<li>Select the new object</li>
</ul>
<p>If any of these operations fail, one of the following error codes must be returned:</p>
<table class="doxtable">
<tr>
<th>Error condition </th><th>Response code</th></tr>
<tr>
<td>The specified object type is not supported. </td><td><a class="el" href="group__nrf__dfu__rescodes.html#gga31217e9d52d12cb3d3dc3c2c5cba4211a597a549dba6ef7f94c1c492b63ee5d3e">NRF_DFU_RES_CODE_UNSUPPORTED_TYPE</a> </td></tr>
<tr>
<td>The specified size is zero. </td><td><a class="el" href="group__nrf__dfu__rescodes.html#gga31217e9d52d12cb3d3dc3c2c5cba4211acbe549f2e19090aeeba66bfad2fe766e">NRF_DFU_RES_CODE_INVALID_PARAMETER</a> </td></tr>
<tr>
<td>The specified size for a data object is not page aligned, and it is not the last object. </td><td><a class="el" href="group__nrf__dfu__rescodes.html#gga31217e9d52d12cb3d3dc3c2c5cba4211acbe549f2e19090aeeba66bfad2fe766e">NRF_DFU_RES_CODE_INVALID_PARAMETER</a> </td></tr>
<tr>
<td>The DFU target cannot accept an object of the specified size. </td><td><a class="el" href="group__nrf__dfu__rescodes.html#gga31217e9d52d12cb3d3dc3c2c5cba4211af54a2806ebcbd3d5b5675fe3d9a7d5c5">NRF_DFU_RES_CODE_INSUFFICIENT_RESOURCES</a> </td></tr>
<tr>
<td>The current state of the transfer does not permit creating an object of the given size and type. </td><td><a class="el" href="group__nrf__dfu__rescodes.html#gga31217e9d52d12cb3d3dc3c2c5cba4211a9fd490a7a3ca55ff97b709433d590a14">NRF_DFU_RES_CODE_OPERATION_NOT_PERMITTED</a> </td></tr>
<tr>
<td>The progress cannot be reset. </td><td><a class="el" href="group__nrf__dfu__rescodes.html#gga31217e9d52d12cb3d3dc3c2c5cba4211afaee5b61948735cefa97fb5762bb90a6">NRF_DFU_RES_CODE_OPERATION_FAILED</a> </td></tr>
</table>
<h2><a class="anchor" id="lib_dfu_transport_op_write"></a>
Write request</h2>
<p>The Write request triggers storing the received data on the device. How the data is written depends on the type of the currently selected object.</p>
<p>After storing the received data, the DFU target must calculate the new CRC and offset and return it.</p>
<p>If any of the operations fail, one of the following error codes must be returned:</p>
<table class="doxtable">
<tr>
<th>Error condition </th><th>Response code</th></tr>
<tr>
<td>The object type of the currently selected object is invalid. </td><td><a class="el" href="group__nrf__dfu__rescodes.html#gga31217e9d52d12cb3d3dc3c2c5cba4211a09a912a599bf9e93c6ae5d4c16463d05">NRF_DFU_RES_CODE_INVALID_OBJECT</a> </td></tr>
<tr>
<td>The current state of the transfer does not permit writing to the current object. </td><td><a class="el" href="group__nrf__dfu__rescodes.html#gga31217e9d52d12cb3d3dc3c2c5cba4211a9fd490a7a3ca55ff97b709433d590a14">NRF_DFU_RES_CODE_OPERATION_NOT_PERMITTED</a> </td></tr>
<tr>
<td>The specified size is zero. </td><td><a class="el" href="group__nrf__dfu__rescodes.html#gga31217e9d52d12cb3d3dc3c2c5cba4211acbe549f2e19090aeeba66bfad2fe766e">NRF_DFU_RES_CODE_INVALID_PARAMETER</a> </td></tr>
<tr>
<td>The specified size is too large. </td><td><a class="el" href="group__nrf__dfu__rescodes.html#gga31217e9d52d12cb3d3dc3c2c5cba4211acbe549f2e19090aeeba66bfad2fe766e">NRF_DFU_RES_CODE_INVALID_PARAMETER</a> </td></tr>
</table>
<h2><a class="anchor" id="lib_dfu_transport_op_execute"></a>
Execute request</h2>
<p>The Execute request should be submitted after an object has been written completely. The triggered actions depend on the type of the object that was transferred:</p>
<ul>
<li>When all objects of the firmware image have been transferred, postvalidation is called. If postvalidation is successful, it triggers the activation of the received firmware image.</li>
<li>Command objects are treated differently by each transport. Therefore, actions and return codes for executing command objects are defined by the implementation.</li>
</ul>
<p>If any of the operations fail, either an implementation-specific error code or one of the following error codes must be returned:</p>
<table class="doxtable">
<tr>
<th>Error condition </th><th>Response code</th></tr>
<tr>
<td>The object type of the currently selected object is invalid. </td><td><a class="el" href="group__nrf__dfu__rescodes.html#gga31217e9d52d12cb3d3dc3c2c5cba4211a09a912a599bf9e93c6ae5d4c16463d05">NRF_DFU_RES_CODE_INVALID_OBJECT</a> </td></tr>
<tr>
<td>The current state of the transfer does not permit executing the current object. </td><td><a class="el" href="group__nrf__dfu__rescodes.html#gga31217e9d52d12cb3d3dc3c2c5cba4211a9fd490a7a3ca55ff97b709433d590a14">NRF_DFU_RES_CODE_OPERATION_NOT_PERMITTED</a> </td></tr>
</table>
<h2><a class="anchor" id="lib_dfu_transport_op_crc"></a>
CRC request</h2>
<p>The CRC request triggers a report of the offset and CRC of the transferred data of the current object. The DFU controller must regularly check these values to ensure that the data is transferred correctly.</p>
<p>If the operation fails, the following error code must be returned:</p>
<table class="doxtable">
<tr>
<th>Error condition </th><th>Response code</th></tr>
<tr>
<td>The object type of the currently selected object is invalid. </td><td><a class="el" href="group__nrf__dfu__rescodes.html#gga31217e9d52d12cb3d3dc3c2c5cba4211a09a912a599bf9e93c6ae5d4c16463d05">NRF_DFU_RES_CODE_INVALID_OBJECT</a> </td></tr>
</table>
<h2><a class="anchor" id="lib_dfu_transport_op_select"></a>
Select request</h2>
<p>The Select request triggers the last transferred object of the specified object type to be selected, thus to be made the currently active object. It also requests information about the object (the maximum size, the current offset, and the current CRC). If there is no valid object of that type, the object type is still selected. In this case, the returned CRC and offset are zero.</p>
<h1><a class="anchor" id="lib_dfu_transport_available_transport_layers"></a>
Transport layers</h1>
<p>The following transport layers are available:</p>
<ul>
<li><a class="el" href="lib_dfu_transport_ble.html">BLE</a></li>
<li><a class="el" href="lib_dfu_transport_serial.html">Experimental: Serial</a> </li>
</ul>
</div></div><!-- contents -->
</div><!-- doc-content -->
<div id="nav-path" class="topicfooter">
<a href="mailto:docfeedback@nordicsemi.no?subject=Documentation%20feedback" id="maillink">Documentation feedback</a> | <a href="https://devzone.nordicsemi.com/questions/" target="_blank">Developer Zone</a> | <a href="http://response.nordicsemi.com/subscribe-to-our-newsletters" target="_blank">Subscribe</a> | Updated <span id="date"/>
<script>
var date = new Date("Fri Mar 10 2017" + " UTC");
document.getElementById("date").innerHTML = date.toJSON().slice(0, 10);
var url=window.location.href.split("?")[0];
var filename=url.substring(url.lastIndexOf('/')+1);
document.getElementById("maillink").href = "mailto:docfeedback@nordicsemi.no?subject=Documentation%20feedback"+decodeURIComponent("%26")+"body=File%20name%3A%20"+encodeURIComponent(filename);
</script>
</div>
</body>
</html>
